# AI Team Plugin - 端到端测试场景

> **版本**: 1.0.0
> **最后更新**: 2026-01-28
> **测试范围**: 完整的 AI Team 工作流程

---

## 📋 测试场景列表

### 场景 1: 简单任务 - 单个角色

**测试命令**:
```bash
/assign developer 修复登录页面的样式问题
```

**预期流程**:
1. ✅ 命令被识别（不显示 "Unknown skill"）
2. ✅ 加载 developer 角色定义
3. ✅ 加载 MCP 权限配置
4. ✅ Developer subagent 分析任务
5. ✅ 实现修复代码
6. ✅ 自查代码质量
7. ✅ 提交代码

**验收标准**:
- [ ] 命令识别成功
- [ ] Developer 角色正确加载
- [ ] MCP 配置正确应用（不能使用 git-push）
- [ ] 代码实现完成
- [ ] Git commit 成功

**测试时间**: 5-10 分钟

---

### 场景 2: 中等任务 - 2-3 个角色协作

**测试命令**:
```bash
/ai-team 开发用户权限管理功能
```

**预期流程**:
1. ✅ 命令被识别
2. ✅ Product Manager 分析需求
3. ✅ Architect 设计系统架构
4. ✅ Developer 实现功能
5. ✅ QA Engineer 编写测试
6. ✅ Code Reviewer 审查代码
7. ✅ 双阶段审查（规范 → 质量）
8. ✅ 代码合并

**验收标准**:
- [ ] 智能路由正确判断任务复杂度
- [ ] 分配合适的角色
- [ ] 各角色协作顺畅
- [ ] MCP 权限正确隔离
- [ ] 最终代码质量合格

**测试时间**: 15-20 分钟

---

### 场景 3: MCP 工具强制使用

**测试命令**:
```bash
/assign product-manager 调研市场竞争情况
```

**预期流程**:
1. ✅ 加载 Product Manager 角色
2. ✅ 检测到必需 MCP: playwright
3. ✅ 强制使用浏览器进行调研
4. ✅ 不能凭空猜测或仅凭经验
5. ✅ 生成市场调研报告

**验收标准**:
- [ ] 正确识别必需 MCP
- [ ] 强制使用浏览器 MCP
- [ ] 调研过程真实可靠
- [ ] 报告包含数据来源

**测试时间**: 10-15 分钟

---

### 场景 4: UI 设计任务

**测试命令**:
```bash
/assign ui-ux-designer 设计用户登录页面
```

**预期流程**:
1. ✅ 加载 UI/UX Designer 角色
2. ✅ 检测到必需 MCP: mastergo-mcp
3. ✅ 使用 MasterGo 创建设计稿
4. ✅ 导出设计资源
5. ✅ 交付设计文档

**验收标准**:
- [ ] 必需 MCP: mastergo-mcp 被使用
- [ ] 设计稿符合要求
- [ ] 资源导出成功
- [ ] 设计文档完整

**测试时间**: 15-20 分钟

---

### 场景 5: 智能路由测试

**测试命令**:
```bash
/ai-team 添加一个新按钮到首页
```

**预期行为**:
- ✅ 判断为"简单任务"
- ✅ 只分配 Developer 角色
- ✅ 不启动完整团队协作

**测试命令**:
```bash
/ai-team 从零搭建电商网站
```

**预期行为**:
- ✅ 判断为"复杂任务"
- ✅ 启动完整团队协作
- ✅ 多角色按序执行

**验收标准**:
- [ ] 简单任务快速完成
- [ ] 复杂任务完整协作
- [ ] 路由判断准确

**测试时间**: 5-10 分钟

---

### 场景 6: 错误处理测试

**测试命令**:
```bash
/assign invalid-role 测试任务
```

**预期行为**:
- ✅ 检测到无效角色
- ✅ 显示可用角色列表
- ✅ 提示重新选择

**测试命令**:
```bash
/assign product-manager （空任务描述）
```

**预期行为**:
- ✅ 检测到任务描述为空
- ✅ 提示输入任务描述
- ✅ 不执行空任务

**验收标准**:
- [ ] 错误提示清晰
- [ ] 不会崩溃
- [ ] 提供有用的修复建议

**测试时间**: 5 分钟

---

### 场景 7: MCP 权限隔离测试

**测试步骤**:
1. 同时启动两个 subagent：
   - Product Manager（禁止 git-push）
   - DevOps Engineer（允许 git-push）

2. 尝试执行 git push

**预期行为**:
- ✅ Product Manager 被阻止
- ✅ DevOps Engineer 被允许
- ✅ 权限隔离生效

**验收标准**:
- [ ] 权限控制正确
- [ ] 不同角色权限不同
- [ ] 安全规则生效

**测试时间**: 10 分钟

---

### 场景 8: Beads 集成测试

**前置条件**:
```bash
npm install -g @beads/cli
cd /root/dev/set_claude/ai-team-plugin
bd init
```

**测试命令**:
```bash
/ai-team 完成一个测试任务
```

**预期行为**:
1. ✅ 任务完成后自动创建 Beads issue
2. ✅ 记录决策到 docs/decisions/
3. ✅ 同步到 Git（bd sync）

**验收标准**:
- [ ] Beads 任务自动创建
- [ ] 决策记录完整
- [ ] Git 同步成功

**测试时间**: 10 分钟

---

### 场景 9: Git Hooks 测试

**测试步骤**:
1. 修改一个配置文件
2. 尝试提交不符合规范的代码

**预期行为**:
- ✅ Pre-commit hook 检测到问题
- ✅ 显示错误信息
- ✅ 阻止提交

**测试步骤**:
1. 修复问题
2. 重新提交

**预期行为**:
- ✅ Pre-commit hook 检查通过
- ✅ Commit-msg hook 验证通过
- ✅ 提交成功

**验收标准**:
- [ ] Hooks 正常工作
- [ ] 错误检测准确
- [ ] 修复后可以提交

**测试时间**: 10 分钟

---

### 场景 10: 完整工作流测试

**测试命令**:
```bash
/ai-team 开发一个完整的博客系统
```

**预期流程**:
1. ✅ Product Manager - 需求分析和任务分解
2. ✅ Architect - 系统架构设计
3. ✅ Developer - 代码实现
4. ✅ Frontend Expert - 前端开发
5. ✅ Backend Expert - 后端开发
6. ✅ Database Expert - 数据库设计
7. ✅ QA Engineer - 测试
8. ✅ Code Reviewer - 代码审查
9. ✅ Security Expert - 安全审查
10. ✅ DevOps Engineer - 部署配置

**验收标准**:
- [ ] 所有角色正确执行
- [ ] 协作流程顺畅
- [ ] 最终交付完整
- [ ] 代码质量合格
- [ ] 测试覆盖充分
- [ ] 文档完整

**测试时间**: 30-40 分钟

---

## 🧪 测试执行指南

### 准备工作

1. **安装插件**:
   ```bash
   /plugin marketplace add /root/dev/set_claude/ai-team-marketplace
   /plugin install ai-team
   ```

2. **验证安装**:
   ```bash
   /ai-team --help
   ```

3. **（可选）安装 Beads**:
   ```bash
   npm install -g @beads/cli
   cd /root/dev/set_claude/ai-team-plugin
   bd init
   ```

### 执行测试

```bash
# 运行所有测试
for scenario in {1..10}; do
  echo "执行场景 $scenario..."
  # 按照场景说明执行测试
done
```

### 记录结果

创建测试报告: `tests/e2e-test-results.md`

```markdown
## 测试结果 - [日期]

| 场景 | 状态 | 测试时间 | 备注 |
|------|------|----------|------|
| 场景 1 | ✅/❌ | 10 min | |
| 场景 2 | ✅/❌ | 20 min | |
...
```

---

## 📊 成功标准

### 必须通过（P0）
- [ ] 场景 1: 简单任务
- [ ] 场景 3: MCP 工具强制使用
- [ ] 场景 6: 错误处理

### 应该通过（P1）
- [ ] 场景 2: 中等任务协作
- [ ] 场景 4: UI 设计任务
- [ ] 场景 5: 智能路由

### 最好通过（P2）
- [ ] 场景 7: MCP 权限隔离
- [ ] 场景 8: Beads 集成
- [ ] 场景 9: Git Hooks
- [ ] 场景 10: 完整工作流

---

## 🐛 问题记录

如果测试失败，记录以下信息：

```markdown
### 问题: [场景名称]

**步骤**:
1.
2.

**预期**:
-

**实际**:
-

**错误信息**:
-

**截图/日志**:
-

**严重程度**: P0/P1/P2
```

---

## 📝 测试报告模板

```markdown
# E2E 测试报告

**测试日期**: [日期]
**测试人员**: [姓名]
**测试版本**: [版本号]

## 执行摘要

- 总场景数: 10
- 通过: X
- 失败: X
- 阻塞: X
- 通过率: XX%

## 详细结果

[各场景的详细结果]

## 问题汇总

[列出所有发现的问题]

## 建议

[改进建议]
```

---

**文档版本**: 1.0.0
**最后更新**: 2026-01-28
**维护者**: AI Team System
